version: v1.0
name: First pipeline example
agent:
  machine:
    type: e1-standard-8
    os_image: ubuntu1804

blocks:
  - name: "Deploy production"
    task:
      env_vars:
        - name: APP_ENV
          value: prod
      jobs:

      - name: "Deploying"
        commands:
          - checkout
          - echo "Setup CIBU."
          - curl -L https://github.com/titanium-codes/cibu/archive/master.zip > /tmp/cibu.zip
          - unzip /tmp/cibu.zip -d /tmp && mkdir -p /opt/cibu
          - mv /tmp/cibu-master/cibu/* /opt/cibu/ && mv /tmp/cibu-master/bin /usr/local/bin/cibu
          - rm -rf /tmp/cibu* && chmod +x /usr/local/bin/*
          - ls -1
          - cibu prepare-ssh
